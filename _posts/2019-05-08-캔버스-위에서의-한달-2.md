---
layout: post
title: '캔버스 위에서의 한달(2)'
date:   2019-05-08 00:00:00.123 +0900
author: Rockheung
tags: codestates javascript bootcamp canvas
categories: Daily

---

... 중간에 작은 위기가 있었는데, 바로 컴포넌트가 업데이트할 때마다 화면의 유닛이 깜박이는 현상이 발생한 거였다. 캔버스에 이미지를 그리는 함수가 어떤 식으로 작동할지 유심히 고민하지 않은 결과였다. 맨 처음에는, 리액트와 캔버스의 어떤 아직 내가 알지 못하는 불협화음이 아닌가 했다. 

canvas를 한번 리액트에서 render한 시점부터, 사실 더이상의 렌더는 불필요하다. 이미 만들어진 돔의  ref를 따서 그때부터는 자바스크립트로 캔버스에 그림이 그려지기 때문이다. 그래서 이러한 부분을 유념하여 좀 더 리액트에 맞게 설계하는 것이 좋겠다고 판단하고, 리액트의 철학? 바람직한 사용법? 디테일한 라이프사이클을 찾아보기 시작했다. 캔버스를 어떻게 리액트스럽게 쓸 수 있을지 고민했다.

해답은 이미지를 재활용하는게 좋겠다는 생각에서 리팩토링을 하다가 나왔다. 캔버스에 그릴 때마다 서버에 요청이 가는 것은 이미 알고 있었다. 본인이 그렇게 작성했기 때문이다. 하지만 async로 이 promise를 나열했기 때문에, 캔버스에 그림이 그려지는 시점은 항상 서버에서 이미지를 받거나(200), 아니면 아직 브라우저에서 가지고 있는 이미지가 유효하다는 것을 서버에서 밝힌 다음이 될 것이었다(304). 어떤 경우든 캔버스에 그림을 그리는 중에 지연시간이 발생할 수 밖에 없었다.

원인이 명확했다. 서버에 자원을 요청하는 함수와 이를 캔버스에 그리는 함수를 분리하여 해결했다. 결론을 짓자면, 캔버스와 리액트는 딱히 서로 안맞을 만한게 없다. 실시간으로 애니메이션이 필요한 컴포넌트라면, `window.requestAnimationFrame(render)`의 형태로 사용할 수 있다고 한다.



> Written with [StackEdit](https://stackedit.io/).



